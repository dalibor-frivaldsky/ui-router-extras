/** UI-Router Extras v.0.0.14 Module: sticky http://christopherthielen.github.io/ui-router-extras/ - MIT License */
!function(t,e){"use strict";function n(e,n){var a=n,r=a.inheritParams,o=(a.objectKeys,a.protoKeys),s=a.forEach,i=a.map,c={},l={},f=!1;this.registerStickyState=function(t){l[t.name]=t},this.enableDebug=this.debugMode=function(e){return t.isDefined(e)&&(f=e),f},this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(e,n,a,l,v){function d(){var e={};return t.forEach(c,function(t,n){for(var a=p(t),r=0;r<a.length;r++){var o=a[r].parent;e[o.name]=e[o.name]||[],e[o.name].push(t)}e[""]&&(e.__inactives=e[""])}),e}function h(){var t={};return s(c,function(e){s(e.path,function(n){n!==e&&(t[n.name]=t[n.name]||[],t[n.name].push(e))})}),t}function m(){var t={};return s(c,function(e){s(e.path,function(n){n!==e&&n.path.length==e.path.length-1&&(t[n.name]=t[n.name]||[],t[n.name].push(e))})}),t}function p(t){var e=[];if(!t)return e;do t.sticky&&e.push(t),t=t.parent;while(t);return e.reverse(),e}function g(t,e,n){if(t[n]===e[n])return{from:!1,to:!1};var a=n<t.length&&t[n].self.sticky,r=n<e.length&&e[n].self.sticky;return{from:a,to:r}}function $(t,e,n,a){if(a)return"updateStateParams";var r=c[t.self.name];if(!r)return"enter";if(t.self===n)return"updateStateParams";var o=S(e,r.locals.globals.$stateParams,t.ownParams);return o?"reactivate":"updateStateParams"}function x(t,e){var n=c[t.name];if(!n)return null;if(!e)return n;var a=S(e,n.locals.globals.$stateParams,t.ownParams);return a?n:null}function S(e,n,a){if(!t.isArray(a)&&t.isObject(a)&&(a=o(a,["$$keys","$$values","$$equals","$$validates","$$new","$$parent"])),!a){a=[];for(var r in e)a.push(r)}for(var s=0;s<a.length;s++){var i=a[s];if(e[i]!=n[i])return!1}return!0}function E(t,e){for(var n=!1,a=0;a<e.length;a++)if(t.name===e[a].name){n=!0;break}return n}var P={getInactiveStates:function(){var e=[];return t.forEach(c,function(t){e.push(t)}),e},getInactiveStatesByParent:function(){return d()},processTransition:function(e){var o={inactives:[],enter:[],exit:[],keep:0},u=e.fromState.path,l=e.fromParams,f=e.toState.path,v=e.toParams,d=e.reloadStateTree,p=e.options,x=0,P=f[x];for(p.inherit&&(v=r(a,v||{},n.$current,e.toState));P&&P===u[x]&&S(v,l,P.ownParams);)P=f[++x];o.keep=x;var b,k,y,w={},F=g(u,f,x),R=!!p.reload,T=[],_=[],I=[],O=[];for(b=x;b<u.length;b++)F.from?(o.inactives.push(u[b]),T.push(u[b]),o.exit[b]="inactivate"):(O.push(u[b]),o.exit[b]="exit");for(b=x;b<f.length;b++){var j=F.to?$(f[b],v,d,R):"enter";R=R||"updateStateParams"==j,o.enter[b]=j,"reactivate"==j?(_.push(f[b]),y=w[f[b].name]=f[b]):"updateStateParams"==j&&(k=w[f[b].name]=f[b]),I.push(f[b])}var C=h(),M=m(),q=[];f.forEach(function(t){var n=[];if(t===e.toState&&y===e.toState)n=C[t.name]||[];else{var a=M[t.name]||[];a.forEach(function(t){if(!t.sticky&&!E(t,f)){n.push(t);var e=C[t.name]||[];n=n.concat(e)}})}q=q.concat(n)}),O=O.concat(q);var A=[];y===e.toState&&(A=C[y.name]||[]);var B=i(O,function(t){return C[t.name]||[]});return s(B,function(t){O=O.concat(t)}),T=T.concat(i(c,t.identity)),T=T.filter(function(t){return-1===O.indexOf(t)&&-1===I.indexOf(t)}),o.inactives=T,o.reactivatingStates=_,o.deepestReactivateChildren=A,o.inactiveOrphans=q,o},stateInactivated:function(t){c[t.self.name]=t,t.self.status="inactive",t.self.onInactivate&&l.invoke(t.self.onInactivate,t.self,t.locals.globals)},stateReactivated:function(t){c[t.self.name]&&delete c[t.self.name],t.self.status="entered",t.self.onReactivate&&l.invoke(t.self.onReactivate,t.self,t.locals.globals)},stateExiting:function(e,n,a){var r={};t.forEach(n,function(t){r[t.self.name]=!0}),t.forEach(c,function(n,a){!r[a]&&n.includes[e.name]&&(f&&v.debug("Exiting "+a+" because it's a substate of "+e.name+" and wasn't found in ",r),n.self.onExit&&l.invoke(n.self.onExit,n.self,n.locals.globals),t.forEach(n.locals,function(t,e){delete u.locals[e]}),n.locals=null,n.self.status="exited",delete c[a])}),a&&l.invoke(a,e.self,e.locals.globals),e.locals=null,e.self.status="exited",delete c[e.self.name]},stateEntering:function(t,e,n,a){var r=x(t);if(r&&(a||!x(t,e))){var o=t.locals;this.stateExiting(r),t.locals=o}t.self.status="entered",n&&l.invoke(n,t.self,t.locals.globals)},reset:function(a,r){function o(t){P.reset(t)}if("*"===a)return t.forEach(P.getInactiveStates(),o),!0;var s=n.get(a);if(!s)return!1;var i=x(s,r);return i?(P.stateExiting(i),e.$broadcast("$viewContentLoading"),!0):!1}};return P}]}function a(t){return{resolve:{},locals:{globals:s&&s.locals&&s.locals.globals},views:{},self:{},params:{},ownParams:f.hasParamSet?{$$equals:function(){return!0}}:[],surrogateType:t}}t.module("ct.ui.router.extras.sticky",["ct.ui.router.extras.core"]);var r=t.module("ct.ui.router.extras.sticky");n.$inject=["$stateProvider","uirextras_coreProvider"],r.provider("$stickyState",n);var o,s,i,u,c=[],l={},f={hasParamSet:!1};t.module("ct.ui.router.extras.sticky").run(["$stickyState",function(t){o=t}]),t.module("ct.ui.router.extras.sticky").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider","uirextras_coreProvider",function(n,r,v,d,h){function m(e,n,a){function r(t,e,n){return t[e]?t[e].toUpperCase()+": "+n.self.name:"("+n.self.name+")"}var s=E(a.inactives,function(t){return t.self.name}),i=E(n.toState.path,function(t,e){return r(a.enter,e,t)}),u=E(n.fromState.path,function(t,e){return r(a.exit,e,t)}),c=n.fromState.self.name+": "+t.toJson(n.fromParams)+":  -> "+n.toState.self.name+": "+t.toJson(n.toParams);e.debug("   Current transition: ",c),e.debug("Before transition, inactives are:   : ",E(o.getInactiveStates(),function(t){return t.self.name})),e.debug("After transition,  inactives will be: ",s),e.debug("Transition will exit:  ",u),e.debug("Transition will enter: ",i)}function p(t,e,n){t.debug("Current state: "+e.self.name+", inactive states: ",E(o.getInactiveStates(),function(t){return t.self.name}));for(var a=function(t,e){return"'"+e+"' ("+t.$$state.name+")"},r=function(t,e){return"globals"!=e&&"resolve"!=e},s=function(t){var e=E(P(t.locals,r),a).join(", ");return"("+(t.self.name?t.self.name:"root")+".locals"+(e.length?": "+e:"")+")"},i=s(e),u=e.parent;u&&u!==e;)""===u.self.name&&(i=s(n.$current.path[0])+" / "+i),i=s(u)+" / "+i,e=u,u=e.parent;t.debug("Views: "+i)}var g=h,$=g.internalStates,x=g.inherit,S=(g.inheritParams,g.forEach),E=g.map,P=g.filterObj;f.hasParamSet=!!d.ParamSet,u=t.extend(new a("__inactives"),{self:{name:"__inactives"}}),s=i=e,c=[],h.onStateRegistered(function(t){t.self.sticky===!0&&v.registerStickyState(t.self)});var b;n.decorator("$state",["$delegate","$log","$q",function(n,r,h){return s=n.$current,$[""]=s,s.parent=u,u.parent=e,u.locals=x(l,u.locals),s.locals=x(u.locals,s.locals),delete u.locals.globals,b=n.transitionTo,n.transitionTo=function(e,g,x){function P(e){var n=t.extend(new a("reactivate_phase1"),{locals:e.locals});return n.self=t.extend({},e.self),n}function k(e){var n=t.extend(new a("reactivate_phase2"),e),r=n.self.onEnter;return n.resolve={},n.views={},n.self.onEnter=function(){n.locals=e.locals,o.stateReactivated(e)},L.addRestoreFunction(function(){e.self.onEnter=r}),n}function y(t){var e=new a("inactivate");e.self=t.self;var n=t.self.onExit;return e.self.onExit=function(){o.stateInactivated(t)},L.addRestoreFunction(function(){t.self.onExit=n}),e}function w(t,e){var n=t.self.onEnter;return t.self.onEnter=function(){o.stateEntering(t,e,n)},L.addRestoreFunction(function(){t.self.onEnter=n}),t}function F(t,e){var n=t.self.onEnter;return t.self.onEnter=function(){o.stateEntering(t,e,n,!0)},L.addRestoreFunction(function(){t.self.onEnter=n}),t}function R(t){var e=t.self.onExit;return t.self.onExit=function(){o.stateExiting(t,J,e)},L.addRestoreFunction(function(){t.self.onExit=e}),t}var T=v.debugMode();u.locals||(u.locals=s.locals);var _=c.length;i&&(i(),T&&r.debug("Restored paths from pending transition"));var I,O,j,C,M=n.$current,q=n.params,A=x&&x.relative||n.$current,B=n.get(e,A),D=[],J=[];g=g||{},arguments[1]=g;var K=function(){},L=function(){I&&(U.path=I,I=null),O&&(M.path=O,O=null),t.forEach(L.restoreFunctions,function(t){t()}),L=K,i=null,c.splice(_,1)};if(L.restoreFunctions=[],L.addRestoreFunction=function(t){this.restoreFunctions.push(t)},B){var U=$[B.name];if(U){I=U.path,O=M.path;var V=x&&x.reload||!1,z=V&&(V===!0?I[0].self:n.get(V,A));x&&V&&V!==!0&&delete x.reload;var G={toState:U,toParams:g||{},fromState:M,fromParams:q||{},options:x,reloadStateTree:z};if(c.push(G),i=L,z){G.toParams.$$uirouterextrasreload=Math.random();var H=z.$$state().params,N=z.$$state().ownParams;if(f.hasParamSet){var Q=new d.Param("$$uirouterextrasreload");H.$$uirouterextrasreload=N.$$uirouterextrasreload=Q,L.restoreFunctions.push(function(){delete H.$$uirouterextrasreload,delete N.$$uirouterextrasreload})}else H.push("$$uirouterextrasreload"),N.push("$$uirouterextrasreload"),L.restoreFunctions.push(function(){H.length=H.length-1,N.length=N.length-1})}j=o.processTransition(G),T&&m(r,G,j);var W=U.path.slice(0,j.keep),X=M.path.slice(0,j.keep);t.forEach(u.locals,function(t,e){-1!=e.indexOf("@")&&delete u.locals[e]});var Y=function(t){return function(e,n){-1!==n.indexOf("@")&&(t[n]=e)}};S(j.inactives,function(t){S(t.locals,Y(u.locals))}),S(j.reactivatingStates,function(t){S(t.locals,Y(l))}),L.addRestoreFunction(function(){S(l,function(t,e){delete l[e]})}),t.forEach(j.enter,function(t,e){var n,a=U.path[e];"reactivate"===t?(n=P(a),W.push(n),X.push(n),D.push(k(a)),C=a):"updateStateParams"===t?(W.push(F(a)),C=a):"enter"===t&&W.push(w(a))}),t.forEach(j.exit,function(t,e){var n=M.path[e];"inactivate"===t?(X.push(y(n)),J.push(n)):"exit"===t&&(X.push(R(n)),J.push(n))}),D.length&&t.forEach(D,function(t){W.push(t)});var Z=j.inactiveOrphans;X=X.concat(E(Z,function(t){return R(t)})),J=J.concat(Z),M.path=X,U.path=W;var tt=function(t){return(t.surrogateType?t.surrogateType+":":"")+t.self.name};T&&r.debug("SurrogateFromPath: ",E(X,tt)),T&&r.debug("SurrogateToPath:   ",E(W,tt))}}var et=b.apply(n,arguments);return et.then(function(t){return L(),T&&p(r,$[t.name],n),t.status="active",t},function(t){return L(),T&&"transition prevented"!==t.message&&"transition aborted"!==t.message&&"transition superseded"!==t.message&&(r.debug("transition failed",t),r.debug(t.stack)),h.reject(t)})},n}])}])}(angular);